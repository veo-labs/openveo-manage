<!DOCTYPE html>
<html lang="en" class="yui-overrride">
<head>
    <meta charset="utf-8">
    <title>app/server/manageables/Manageable.js - OpenVeo Manage server</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1 class="blue-main-title">OpenVeo Manage server</h1>
        </div>
        <div class="yui3-u-1-4 version project-version">
            API Docs for: 5.0.1
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/BrowserPilot.html">BrowserPilot</a></li>
                                <li><a href="../classes/BROWSERS_MESSAGES.html">BROWSERS_MESSAGES</a></li>
                                <li><a href="../classes/BrowserSocketController.html">BrowserSocketController</a></li>
                                <li><a href="../classes/browsersPilotManager.html">browsersPilotManager</a></li>
                                <li><a href="../classes/Cache.html">Cache</a></li>
                                <li><a href="../classes/Device.html">Device</a></li>
                                <li><a href="../classes/DeviceProvider.html">DeviceProvider</a></li>
                                <li><a href="../classes/ERRORS.html">ERRORS</a></li>
                                <li><a href="../classes/Group.html">Group</a></li>
                                <li><a href="../classes/GroupProvider.html">GroupProvider</a></li>
                                <li><a href="../classes/Manageable.html">Manageable</a></li>
                                <li><a href="../classes/ManageableProvider.html">ManageableProvider</a></li>
                                <li><a href="../classes/ManagePlugin.html">ManagePlugin</a></li>
                                <li><a href="../classes/Manager.html">Manager</a></li>
                                <li><a href="../classes/ScheduleManager.html">ScheduleManager</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/controllers.html">controllers</a></li>
                                <li><a href="../modules/manage.html">manage</a></li>
                                <li><a href="../modules/manageables.html">manageables</a></li>
                                <li><a href="../modules/providers.html">providers</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: app/server/manageables/Manageable.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x27;use strict&#x27;;

/**
 * @module manageables
 */

/**
 * Defines a Manageable which is an element with an history and a planning.
 *
 * @class Manageable
 * @constructor
 * @param {Object} manageable A device description object
 * @param {String} manageable.id The manageable id
 * @param {String} [manageable.name] The manageable name
 * @param {String} [manageable.state] The manageable state
 * @param {Array} [manageable.history] The list of history events related to the manageable
 * @param {Array} [manageable.schedules] The list of manageable&#x27;s schedules
 */
function Manageable(manageable) {
  Object.defineProperties(this, {

    /**
     * The manageable&#x27;s id.
     *
     * @property id
     * @type String
     * @final
     */
    id: {value: manageable.id, enumerable: true},

    /**
     * The manageable&#x27;s name.
     *
     * @property name
     * @type String
     * @final
     */
    name: {value: manageable.name, writable: true, enumerable: true},

    /**
     * The manageable&#x27;s history.
     *
     * @property history
     * @type Array
     */
    history: {value: manageable.history || [], writable: true, enumerable: true},

    /**
     * The manageable&#x27;s schedules.
     *
     * @property schedules
     * @type Array
     */
    schedules: {value: manageable.schedules || [], writable: true, enumerable: true}

  });
}

module.exports = Manageable;

/**
 * Gets all ranges of time a schedule occupies for each day of the week.
 *
 * A schedule may start on a day and terminates another one or it may also start on a day and terminates the same day
 * one week later.
 *
 * @method getScheduleOccupiedTimePerDay
 * @param {Object} schedule Schedule object with:
 * @param {Date} schedule.beginDate The begin date of the schedule
 * @param {Number} schedule.duration The schedule duration (in ms)
 * @param {String} [schedule.recurrent] Either &#x27;daily&#x27; or &#x27;weekly&#x27; if recurrent
 * @param {Date} [schedule.endDate] The end date of the daily schedule (required if recurrent is specified)
 */
Manageable.prototype.getScheduleOccupiedTimePerDay = function(schedule) {

  // Calculate schedules start and end times without caring about days
  var scheduleDateTimeBegin = new Date(schedule.beginDate);
  var scheduleDateTimeEnd = new Date(scheduleDateTimeBegin.getTime() + schedule.duration);
  var scheduleTimeBegin = (scheduleDateTimeBegin.getHours() * 3600000) +
      (scheduleDateTimeBegin.getMinutes() * 60000) +
      scheduleDateTimeBegin.getSeconds() * 1000;
  var scheduleTimeEnd = (scheduleDateTimeEnd.getHours() * 3600000) +
      (scheduleDateTimeEnd.getMinutes() * 60000) +
      scheduleDateTimeEnd.getSeconds() * 1000;

  var completeDayTime = (23 * 3600000) + (59 * 60000) + (59 * 1000);
  var completeDayOccupiedTime = {
    start: 0,
    end: completeDayTime
  };

  // Build an array to hold the occupied time of schedule in each day of the week
  var scheduleOccupiedTimePerDay = new Array(7);

  if (scheduleDateTimeBegin.getDay() === scheduleDateTimeEnd.getDay()) {

    // Schedule starts and terminates the same day of the week but it doesn&#x27;t mean this is the same week
    // If this is the same day of the same week then the begin time should be lesser than the end time

    if (scheduleTimeBegin &gt; scheduleTimeEnd) {

      // Schedule range covers almost a whole week (remember we assumed it can&#x27;t be a whole week)
      // Same day but different week

      // Start by marking all days of the week as occupied at full time
      scheduleOccupiedTimePerDay.fill([completeDayOccupiedTime]);

      // Override precise day occupied time with two ranges of occupied time (for the day it starts and the
      // day it ends)
      // The first occupied range goes from the start time to the end of the day as it continues until next week
      // The second occupied range goes from the beginning of the day to the end time
      scheduleOccupiedTimePerDay[scheduleDateTimeBegin.getDay()] = [{
        start: scheduleTimeBegin,
        end: completeDayTime
      }, {
        start: 0,
        end: scheduleTimeEnd
      }];

    } else {

      // Schedule is on a single day
      // Same day, same week
      // If schedule is daily add occupied time for each day of the week

      scheduleOccupiedTimePerDay.fill(
        [
          {
            start: scheduleTimeBegin,
            end: scheduleTimeEnd
          }
        ],
        (schedule.recurrent === &#x27;daily&#x27;) ? 0 : scheduleDateTimeBegin.getDay(),
        (schedule.recurrent === &#x27;daily&#x27;) ? 7 : scheduleDateTimeBegin.getDay() + 1
      );
    }

  } else {

    // Schedule starts on a day an terminates on another
    // If schedule is daily add an occupied time for each day of the week

    // Mark days between start day and end day as occupied at full time excluding start day and end day
    if (scheduleDateTimeBegin.getDay() &lt; scheduleDateTimeEnd.getDay()) {
      scheduleOccupiedTimePerDay.fill(
        [completeDayOccupiedTime],
        scheduleDateTimeBegin.getDay() + 2,
        scheduleDateTimeEnd.getDay()
      );
    } else {
      scheduleOccupiedTimePerDay.fill(
        [completeDayOccupiedTime],
        scheduleDateTimeBegin.getDay() + 2
      );
      scheduleOccupiedTimePerDay.fill(
        [completeDayOccupiedTime],
        0,
        scheduleDateTimeEnd.getDay()
      );
    }

    // Set day occupied time with two ranges of occupied time (for the day it starts and the day it ends)
    // The first occupied range goes from the start time to the end of the day as it continues until next week
    // The second occupied range goes from the beginning of the day to the end time
    var startDayOccupiedTime = {
      start: scheduleTimeBegin,
      end: completeDayTime
    };
    var endDayOccupiedTime = {
      start: 0,
      end: scheduleTimeEnd
    };

    if (schedule.recurrent === &#x27;daily&#x27;) {

      // Schedule is daily
      // Add occupied time for the start day and end day for all days of the week

      scheduleOccupiedTimePerDay.fill([startDayOccupiedTime, endDayOccupiedTime]);
    } else {

      // Schedule is not daily
      // Set occupied time for begin day and end day

      // Start day
      scheduleOccupiedTimePerDay[scheduleDateTimeBegin.getDay()] = [startDayOccupiedTime];

      // End day
      scheduleOccupiedTimePerDay[scheduleDateTimeEnd.getDay()] = [endDayOccupiedTime];

    }

  }

  return scheduleOccupiedTimePerDay;
};

/**
 * Checks if two schedules are in conflict.
 *
 * Conflict examples without recurrence:
 *
 * Example 1:
 * [------------]
 * [------------]
 *
 * Example 2:
 * [------------]
 *              [------------]
 *
 * Example 3:
 *              [------------]
 * [------------]
 *
 * Example 4:
 * [------------]
 *   [------------]
 *
 * Example 5:
 *   [------------]
 * [------------]
 *
 * Example 6:
 * [------------]
 *   [--------]
 *
 * Example 7:
 *   [--------]
 * [------------]
 *
 *
 * Additional conflict examples with daily recurrence:
 *
 * ############################################## EXAMPLE 1 ######################################################
 * | ------------ SUNDAY ------------- || ------------ MONDAY ------------- || ----------- THUESDAY ------------ |
 * |02|04|06|08|10|12|14|16|18|20|22|24||02|04|06|08|10|12|14|16|18|20|22|24||02|04|06|08|10|12|14|16|18|20|22|24|
 *
 *
 *             [DAILY]                              [DAILY]                              [DAILY]
 *                                                  [-----]
 *
 *                                                  [-----]
 *             [DAILY]                              [DAILY]                              [DAILY]
 *
 * ############################################## EXAMPLE 2 ######################################################
 * | ------------ SUNDAY ------------- || ------------ MONDAY ------------- || ----------- THUESDAY ------------ |
 * |02|04|06|08|10|12|14|16|18|20|22|24||02|04|06|08|10|12|14|16|18|20|22|24||02|04|06|08|10|12|14|16|18|20|22|24|
 *
 *             [DAILY]                              [DAILY]                              [DAILY]
 *                                           [-----]
 *
 *                                           [-----]
 *             [DAILY]                              [DAILY]                              [DAILY]
 *
 * ############################################## EXAMPLE 3 ######################################################
 * | ------------ SUNDAY ------------- || ------------ MONDAY ------------- || ----------- THUESDAY ------------ |
 * |02|04|06|08|10|12|14|16|18|20|22|24||02|04|06|08|10|12|14|16|18|20|22|24||02|04|06|08|10|12|14|16|18|20|22|24|
 *
 *             [DAILY]                              [DAILY]                              [DAILY]
 *                                                        [-----]
 *
 *                                                        [-----]
 *             [DAILY]                              [DAILY]                              [DAILY]
 *
 * ############################################## EXAMPLE 4 ######################################################
 * | ------------ SUNDAY ------------- || ------------ MONDAY ------------- || ----------- THUESDAY ------------ |
 * |02|04|06|08|10|12|14|16|18|20|22|24||02|04|06|08|10|12|14|16|18|20|22|24||02|04|06|08|10|12|14|16|18|20|22|24|
 *
 *             [DAILY]                              [DAILY]                              [DAILY]
 *                                                   [---]
 *
 *                                                   [---]
 *             [DAILY]                              [DAILY]                              [DAILY]
 *
 * ############################################## EXAMPLE 5 ######################################################
 * | ------------ SUNDAY ------------- || ------------ MONDAY ------------- || ----------- THUESDAY ------------ |
 * |02|04|06|08|10|12|14|16|18|20|22|24||02|04|06|08|10|12|14|16|18|20|22|24||02|04|06|08|10|12|14|16|18|20|22|24|
 *
 *             [DAILY]                              [DAILY]                              [DAILY]
 *                                              [-------------]
 *
 *                                              [-------------]
 *             [DAILY]                              [DAILY]                              [DAILY]
 *
 * ############################################## EXAMPLE 6 ######################################################
 * | ------------ SUNDAY ------------- || ------------ MONDAY ------------- || ----------- THUESDAY ------------ |
 * |02|04|06|08|10|12|14|16|18|20|22|24||02|04|06|08|10|12|14|16|18|20|22|24||02|04|06|08|10|12|14|16|18|20|22|24|
 *
 *                                                  [-----]
 *          [------------ DAILY -----------]     [------------ DAILY -----------]     [------------ DAILY --------
 *
 *          [------------ DAILY -----------]     [------------ DAILY -----------]     [------------ DAILY --------
 *                                                  [-----]
 *
 * ############################################## EXAMPLE 7 ######################################################
 * | ------------ SUNDAY ------------- || ------------ MONDAY ------------- || ----------- THUESDAY ------------ |
 * |02|04|06|08|10|12|14|16|18|20|22|24||02|04|06|08|10|12|14|16|18|20|22|24||02|04|06|08|10|12|14|16|18|20|22|24|
 *
 *                                                  [-----]
 *                               [---------- DAILY ----------]        [---------- DAILY ----------]        [------
 *
 *                               [---------- DAILY ----------]        [---------- DAILY ----------]        [------
 *                                                  [-----]
 *
 * Additional conflict examples with weekly recurrence:
 *
 * ############################################## EXAMPLE 1 ######################################################
 * | ------------ SUNDAY ------------- || ------------- [..] -------------- || ------------ SUNDAY ------------- |
 * |02|04|06|08|10|12|14|16|18|20|22|24||                                   ||02|04|06|08|10|12|14|16|18|20|22|24|
 *
 *             [WEEKL]                                                                   [WEEKL]
 *                                                                                       [-----]
 *
 *                                                                                       [-----]
 *             [WEEKL]                                                                   [WEEKL]
 *
 * ############################################## EXAMPLE 2 ######################################################
 * | ------------ SUNDAY ------------- || ------------- [..] -------------- || ------------ SUNDAY ------------- |
 * |02|04|06|08|10|12|14|16|18|20|22|24||                                   ||02|04|06|08|10|12|14|16|18|20|22|24|
 *
 *             [WEEKL]                                                                   [WEEKL]
 *                                                                                 [-----]
 *
 *                                                                                 [-----]
 *             [WEEKL]                                                                   [WEEKL]
 *
 * ############################################## EXAMPLE 3 ######################################################
 * | ------------ SUNDAY ------------- || ------------- [..] -------------- || ------------ SUNDAY ------------- |
 * |02|04|06|08|10|12|14|16|18|20|22|24||                                   ||02|04|06|08|10|12|14|16|18|20|22|24|
 *
 *             [WEEKL]                                                                   [WEEKL]
 *                                                                                             [-----]
 *
 *                                                                                             [-----]
 *             [WEEKL]                                                                   [WEEKL]
 *
 * ############################################## EXAMPLE 4 ######################################################
 * | ------------ SUNDAY ------------- || ------------- [..] -------------- || ------------ SUNDAY ------------- |
 * |02|04|06|08|10|12|14|16|18|20|22|24||                                   ||02|04|06|08|10|12|14|16|18|20|22|24|
 *
 *             [WEEKL]                                                                   [WEEKL]
 *                                                                                        [---]
 *
 *                                                                                        [---]
 *             [WEEKL]                                                                   [WEEKL]
 *
 * ############################################## EXAMPLE 5 ######################################################
 * | ------------ SUNDAY ------------- || ------------- [..] -------------- || ------------ SUNDAY ------------- |
 * |02|04|06|08|10|12|14|16|18|20|22|24||                                   ||02|04|06|08|10|12|14|16|18|20|22|24|
 *
 *             [WEEKL]                                                                   [WEEKL]
 *                                                                                    [-----------]
 *
 *                                                                                    [-----------]
 *             [WEEKL]                                                                   [WEEKL]
 *
 * ############################################## EXAMPLE 6 ######################################################
 * | --------- [... SUNDAY] ---------- || ------------ SUNDAY ------------- || ------------ MONDAY ------------- |
 * |02|04|06|08|10|12|14|16|18|20|22|24||02|04|06|08|10|12|14|16|18|20|22|24||02|04|06|08|10|12|14|16|18|20|22|24|
 *
 *             [WEEKL]                              [WEEKL]
 *                                               [------------------------------]
 *
 *                                               [------------------------------]
 *             [WEEKL]                              [WEEKL]
 *
 *
 * Additional conflict examples with both daily and weekly recurrences:
 *
 * ############################################## EXAMPLE 1 ######################################################
 * | ------------ SUNDAY ------------- || ------------- [..] -------------- || ------------ SUNDAY ------------- |
 * |02|04|06|08|10|12|14|16|18|20|22|24||                                   ||02|04|06|08|10|12|14|16|18|20|22|24|
 *
 *             [WEEKL]                                                                   [WEEKL]
 *                                                  [DAILY]                              [DAILY]
 *
 *                                                  [DAILY]                              [DAILY]
 *             [WEEKL]                                                                   [WEEKL]
 *
 * ############################################## EXAMPLE 2 ######################################################
 * | ------------ SUNDAY ------------- || ------------- [..] -------------- || ------------ SUNDAY ------------- |
 * |02|04|06|08|10|12|14|16|18|20|22|24||                                   ||02|04|06|08|10|12|14|16|18|20|22|24|
 *
 *             [WEEKL]                                                                   [WEEKL]
 *                                                        [DAILY]                              [DAILY]
 *
 *                                                        [DAILY]                              [DAILY]
 *             [WEEKL]                                                                   [WEEKL]
 *
 * ############################################## EXAMPLE 3 ######################################################
 * | ------------ SUNDAY ------------- || ------------- [..] -------------- || ------------ SUNDAY ------------- |
 * |02|04|06|08|10|12|14|16|18|20|22|24||                                   ||02|04|06|08|10|12|14|16|18|20|22|24|
 *
 *             [WEEKL]                                                                   [WEEKL]
 *                                            [DAILY]                              [DAILY]
 *
 *                                            [DAILY]                              [DAILY]
 *             [WEEKL]                                                                   [WEEKL]
 *
 * ############################################## EXAMPLE 4 ######################################################
 * | ------------ SUNDAY ------------- || ------------- [..] -------------- || ------------ SUNDAY ------------- |
 * |02|04|06|08|10|12|14|16|18|20|22|24||                                   ||02|04|06|08|10|12|14|16|18|20|22|24|
 *
 *             [WEEKL]                                                                   [WEEKL]
 *                                               [---DAILY---]                        [---DAILY---]
 *
 *                                               [---DAILY---]                        [---DAILY---]
 *             [WEEKL]                                                                   [WEEKL]
 *
 * ############################################## EXAMPLE 5 ######################################################
 * | ------------ SUNDAY ------------- || ------------- [..] -------------- || ------------ SUNDAY ------------- |
 * |02|04|06|08|10|12|14|16|18|20|22|24||                                   ||02|04|06|08|10|12|14|16|18|20|22|24|
 *
 *          [---WEEKL---]                                                                [---WEEKL---]
 *                                                     [DAILY]                              [DAILY]
 *
 *                                                     [DAILY]                              [DAILY]
 *          [---WEEKL---]                                                                [---WEEKL---]
 *
 * @method checkSchedulesConflict
 * @param {Object} schedule1 Schedule object with:
 * @param {Date} schedule1.beginDate The begin date of the schedule
 * @param {Number} schedule1.duration The schedule duration (in ms)
 * @param {String} [schedule1.recurrent] Either &#x27;daily&#x27; or &#x27;weekly&#x27; if recurrent
 * @param {Date} [schedule1.endDate] The end date of the daily schedule (required if recurrent is set to true)
 * @param {Object} schedule2 Schedule object with:
 * @param {Date} schedule2.beginDate The begin date of the schedule
 * @param {Number} schedule2.duration The schedule duration
 * @param {String} [schedule2.recurrent] Either &#x27;daily&#x27; or &#x27;weekly&#x27; if recurrent
 * @param {Date} [schedule2.endDate] The end date of the daily schedule (required if recurrent is set to true)
 * @return {Boolean} true if there are in conflict, false otherwise
 */
Manageable.prototype.checkSchedulesConflict = function(schedule1, schedule2) {
  var schedule1DateTimeBegin = new Date(schedule1.beginDate);
  var schedule1DateTimeEnd = new Date(schedule1DateTimeBegin.getTime() + schedule1.duration);
  var schedule1DateRecurrenceEnd = this.getLastScheduleOccurence(schedule1).endDate;
  var schedule2DateTimeBegin = new Date(schedule2.beginDate);
  var schedule2DateTimeEnd = new Date(schedule2DateTimeBegin.getTime() + schedule2.duration);
  var schedule2DateRecurrenceEnd = this.getLastScheduleOccurence(schedule2).endDate;

  if (

    // Schedule 2 begin date / time inside schedule 1 date / time
    (schedule2DateTimeBegin &gt;= schedule1DateTimeBegin &amp;&amp; schedule2DateTimeBegin &lt;= schedule1DateTimeEnd) ||

    // Schedule 2 end date / time inside schedule 1 date / time
    (schedule2DateTimeEnd &gt;= schedule1DateTimeBegin &amp;&amp; schedule2DateTimeEnd &lt;= schedule1DateTimeEnd) ||

    // Schedule 1 date / time inside schedule 2 date / time
    (schedule2DateTimeBegin &lt;= schedule1DateTimeBegin &amp;&amp; schedule2DateTimeEnd &gt;= schedule1DateTimeEnd)

  ) {

    // Conflict between schedules&#x27; dates first occurences
    return true;
  }

  // Recurrence
  if (
    (

      // Schedule 2 range begin inside schedule 1 range
      (schedule2DateTimeBegin &gt;= schedule1DateTimeBegin &amp;&amp; schedule2DateTimeBegin &lt;= schedule1DateRecurrenceEnd) ||

      // Schedule 2 range end inside schedule 1 range
      (
        schedule2DateRecurrenceEnd &gt;= schedule1DateTimeBegin &amp;&amp;
        schedule2DateRecurrenceEnd &lt;= schedule1DateRecurrenceEnd
      ) ||

      //  Schedule 1 range inside schedule 2 range
      (schedule2DateTimeBegin &lt;= schedule1DateTimeBegin &amp;&amp; schedule2DateRecurrenceEnd &gt;= schedule1DateRecurrenceEnd)

    ) &amp;&amp;
    (schedule1.recurrent || schedule2.recurrent)
  ) {

    // Recurrent schedule with conflicting ranges
    // We know that at least one schedule is recurrent, daily or weekly which means that the days and times must
    // be considered

    // Build one array per schedules to hold the occupied time of schedules in each day of the week
    var schedule1OccupiedTimePerDay = this.getScheduleOccupiedTimePerDay(schedule1);
    var schedule2OccupiedTimePerDay = this.getScheduleOccupiedTimePerDay(schedule2);

    // We have the list of occupied times for each day of the week and for each schedule
    // Check if there are conflicts in occupied times

    // Iterate on days
    for (var day = 0; day &lt; 7; day++) {

      // Iterate on schedule 1 occupied times for the day
      for (var i = 0; i &lt; schedule1OccupiedTimePerDay.length; i++) {
        if (!schedule1OccupiedTimePerDay[day] || !schedule1OccupiedTimePerDay[day][i]) continue;
        var schedule1OccupiedTime = schedule1OccupiedTimePerDay[day][i];
        if (!schedule1OccupiedTime) continue;

        // Iterate on schedule 2 occupied times for the day
        for (var j = 0; j &lt; schedule2OccupiedTimePerDay.length; j++) {
          if (!schedule2OccupiedTimePerDay[day] || !schedule2OccupiedTimePerDay[day][j]) continue;
          var schedule2OccupiedTime = schedule2OccupiedTimePerDay[day][j];

          if (

            // Schedule 2 begin time inside schedule 1 time
            (
              schedule2OccupiedTime.start &gt;= schedule1OccupiedTime.start &amp;&amp;
              schedule2OccupiedTime.start &lt;= schedule1OccupiedTime.end
            ) ||

            // Schedule 2 end time inside schedule 1 time
            (
              schedule2OccupiedTime.end &gt;= schedule1OccupiedTime.start &amp;&amp;
              schedule2OccupiedTime.end &lt;= schedule1OccupiedTime.end
            ) ||

            // Schedule 1 time inside schedule 2 time
            (
              schedule2OccupiedTime.start &lt;= schedule1OccupiedTime.start &amp;&amp;
              schedule2OccupiedTime.end &gt;= schedule1OccupiedTime.end
            )

          ) {

            // Conflict between schedules&#x27; times
            return true;

          }
        }
      }
    }
  }

  return false;
};

/**
 * Adds an historic to manageable&#x27;s history.
 *
 * @method addHistoric
 * @param {Object} historic The historic
 * @param {String} historic.id The historic id
 */
Manageable.prototype.addHistoric = function(historic) {
  this.history.push(historic);
};

/**
 * Removes an historic from manageable&#x27;s history.
 *
 * @method removeHistoric
 * @param {String} historicId The historic id
 * @return {Object|Null} The removed historic or null if not found
 */
Manageable.prototype.removeHistoric = function(historicId) {
  var index = this.history.findIndex(function(historic) {
    return historic.id === historicId;
  });

  if (index &gt; -1)
    return this.history.splice(index, 1)[0];

  return null;
};

/**
 * Removes manageable&#x27;s history.
 *
 * @method removeHistory
 */
Manageable.prototype.removeHistory = function() {
  this.history = [];
};

/**
 * Adds a schedule to manageable&#x27;s schedules.
 *
 * @method addSchedule
 * @param {Object} schedule The schedule
 * @param {String} schedule.id The schedule id
 */
Manageable.prototype.addSchedule = function(schedule) {
  this.schedules.push(schedule);
};

/**
 * Removes a schedule from manageable&#x27;s schedules.
 *
 * @method removeSchedule
 * @param {String} scheduleId The schedule id
 * @return {Object|Null} The removed schedule or null if not found
 */
Manageable.prototype.removeSchedule = function(scheduleId) {
  var index = this.schedules.findIndex(function(schedule) {
    return schedule.id === scheduleId;
  });

  if (index &gt; -1)
    return this.schedules.splice(index, 1)[0];

  return null;
};

/**
 * Gets a schedule.
 *
 * @method getSchedule
 * @param {String} id The schedule id
 * @return {Object|Undefined} The schedule or null if not found
 */
Manageable.prototype.getSchedule = function(id) {
  return this.schedules.find(function(schedule) {
    return (schedule.id === id);
  });
};

/**
 * Checks if a schedule is not in collision with other schedules.
 *
 * @method isValidSchedule
 * @param {Object} schedule The schedule description object
 * @param {Date} schedule.beginDate The begin date of the schedule
 * @param {Number} schedule.duration The schedule duration (in ms)
 * @param {Boolean} [schedule.recurrent=false] true if this is a daily schedule, false otherwise
 * @param {Date} [schedule.endDate] The end date of the daily schedule (required if recurrent is set to true)
 * @return {Boolean} true if the schedule is not in collision with other schedules
 * false otherwise
 */
Manageable.prototype.isValidSchedule = function(schedule) {
  var i = 0;

  // Start date is after end date or start date is before now
  if ((schedule.endDate &amp;&amp; schedule.beginDate &gt;= schedule.endDate) || schedule.beginDate &lt;= new Date())
    return false;


  // Validates that the schedule is not in conflict with one of the existing schedules
  for (i = 0; i &lt; this.schedules.length; i++) {
    if (this.checkSchedulesConflict(this.schedules[i], schedule))
      return false;
  }

  return true;
};

/**
 * Checks if a schedule is actually running.
 *
 * @method isScheduleRunning
 * @param {Object} schedule The schedule description object
 * @param {Date} schedule.beginDate The begin date of the schedule
 * @param {Number} schedule.duration The schedule duration (in ms)
 * @param {Boolean} [schedule.recurrent=false] true if this is a daily schedule, false otherwise
 * @param {Date} [schedule.endDate] The end date of the daily schedule (required if recurrent is set to true)
 * @return {Boolean} true if the schedule is running, false otherwise
 */
Manageable.prototype.isScheduleRunning = function(schedule) {
  var now = new Date();
  var firstOccurrenceEndDate = new Date(schedule.beginDate.getTime() + schedule.duration);

  if (schedule.beginDate &lt;= now &amp;&amp; firstOccurrenceEndDate &gt;= now) return true;

  var scheduleOccupiedTimePerDay = this.getScheduleOccupiedTimePerDay(schedule);
  if (!scheduleOccupiedTimePerDay[now.getDay()]) return false;

  if (schedule.recurrent &amp;&amp; schedule.beginDate &lt;= now &amp;&amp; schedule.endDate &gt;= now) {

    var nowTime = now.getHours() * 3600000 + now.getMinutes() * 60000 + now.getSeconds() * 1000;

    // Iterate on schedule occupied times for the day
    for (var i = 0; i &lt; scheduleOccupiedTimePerDay[now.getDay()].length; i++) {
      var scheduleOccupiedTime = scheduleOccupiedTimePerDay[now.getDay()][i];
      if (!scheduleOccupiedTime) continue;

      if (scheduleOccupiedTime.start &lt;= nowTime &amp;&amp; scheduleOccupiedTime.end &gt;= nowTime) {
        return true;
      }
    }

  }
  return false;
};

/**
 * Gets the last occurence of the given schedule.
 *
 * If schedule is daily the last occurence will start on schedule end day.
 * If schedule is not recurrent the last occurence will start on schedule begin day.
 * If schedule is weekly the last occurence will start on last same day it starts before schedule end day.
 *
 * @param {Object} schedule The schedule to get last occurence from
 * @param {Date|String} [schedule.beginDate] The schedule first occurence begin date
 * @param {Date|String} [schedule.endDate] The schedule expected end date if recurrent is specified
 * @param {String} [schedule.recurrent] Either &quot;daily&quot; or &quot;weekly&quot;
 * @param {Number} [schedule.duration] Occurences duration
 * @return {Object} The last occurence schedule with:
 *   - {Date} beginDate The starting date and time of the last occurence
 *   - {Date} endDate The ending date and time of the last occurence
 *   - {Number} duration The schedule duration
 */
Manageable.prototype.getLastScheduleOccurence = function(schedule) {
  var lastOccurenceBeginDate;
  var scheduleDateTimeBegin = new Date(schedule.beginDate);
  var scheduleDateTimeEnd = new Date(schedule.endDate);

  if (schedule.recurrent === &#x27;daily&#x27;) {

    // For a daily schedule the last occurence starts on the end date

    lastOccurenceBeginDate = new Date(scheduleDateTimeEnd);

  } else if (schedule.recurrent === &#x27;weekly&#x27;) {

    // For a weekly schedule the last occurence depends on the day of the week
    // Begin day can be specified on thuesday and end date on sunday, in this case the last occurence starts last
    // thuesday.
    // Also begin day can be specified on thuesday and end date also on thuesday thus the last occurence will be
    // started on end date.

    if (scheduleDateTimeBegin.getDay() === scheduleDateTimeEnd.getDay()) {

      // Schedule end date is on the same day as the start date which means the end date will go for another occurence

      lastOccurenceBeginDate = new Date(scheduleDateTimeEnd);

    } else {

      // Schedule end date is on another day than begin date day
      // Last occurence starts last same day as the begin date day

      // Find past date of the last same day as the begin date day
      var daysDifference = scheduleDateTimeEnd.getDay() - schedule.beginDate.getDay();
      lastOccurenceBeginDate = new Date(
        scheduleDateTimeEnd.getTime() - (
          daysDifference &lt; 0 ? 7 + daysDifference : daysDifference
        ) * 86400000
      );

    }
  } else {

    // Schedule is not recurrent

    lastOccurenceBeginDate = new Date(schedule.beginDate);

  }

  lastOccurenceBeginDate.setHours(scheduleDateTimeBegin.getHours());
  lastOccurenceBeginDate.setMinutes(scheduleDateTimeBegin.getMinutes());
  lastOccurenceBeginDate.setSeconds(scheduleDateTimeBegin.getSeconds());

  return {
    beginDate: lastOccurenceBeginDate,
    endDate: new Date(lastOccurenceBeginDate.getTime() + schedule.duration),
    duration: schedule.duration
  };
};

/**
 * Checks if a schedule has expired.
 *
 * Schedule is considered expired if schedule last occurence end date and time has passed.
 *
 * @method isScheduleExpired
 * @param {Object} schedule The schedule description object
 * @param {Date} schedule.beginDate The begin date of the schedule
 * @param {Number} schedule.duration The schedule duration (in ms)
 * @param {String} [schedule.recurrent] Either &quot;daily&quot; or &quot;weekly&quot;
 * @param {Date} [schedule.endDate] The end date of the recurrent schedule (required if recurrent is specified)
 * @return {Boolean} true if the schedule has expired, false otherwise
 */
Manageable.prototype.isScheduleExpired = function(schedule) {
  var now = new Date();
  var lastOccurence = this.getLastScheduleOccurence(schedule);
  return lastOccurence.endDate &lt; now;
};

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
