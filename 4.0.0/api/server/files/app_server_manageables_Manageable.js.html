<!DOCTYPE html>
<html lang="en" class="yui-overrride">
<head>
    <meta charset="utf-8">
    <title>app/server/manageables/Manageable.js - OpenVeo Manage server</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1 class="blue-main-title">OpenVeo Manage server</h1>
        </div>
        <div class="yui3-u-1-4 version project-version">
            API Docs for: 4.0.0
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/BrowserPilot.html">BrowserPilot</a></li>
                                <li><a href="../classes/BROWSERS_MESSAGES.html">BROWSERS_MESSAGES</a></li>
                                <li><a href="../classes/BrowserSocketController.html">BrowserSocketController</a></li>
                                <li><a href="../classes/browsersPilotManager.html">browsersPilotManager</a></li>
                                <li><a href="../classes/Cache.html">Cache</a></li>
                                <li><a href="../classes/Device.html">Device</a></li>
                                <li><a href="../classes/DeviceProvider.html">DeviceProvider</a></li>
                                <li><a href="../classes/ERRORS.html">ERRORS</a></li>
                                <li><a href="../classes/Group.html">Group</a></li>
                                <li><a href="../classes/GroupProvider.html">GroupProvider</a></li>
                                <li><a href="../classes/Manageable.html">Manageable</a></li>
                                <li><a href="../classes/ManageableProvider.html">ManageableProvider</a></li>
                                <li><a href="../classes/ManagePlugin.html">ManagePlugin</a></li>
                                <li><a href="../classes/Manager.html">Manager</a></li>
                                <li><a href="../classes/ScheduleManager.html">ScheduleManager</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/controllers.html">controllers</a></li>
                                <li><a href="../modules/manage.html">manage</a></li>
                                <li><a href="../modules/manageables.html">manageables</a></li>
                                <li><a href="../modules/providers.html">providers</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: app/server/manageables/Manageable.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x27;use strict&#x27;;

/**
 * @module manageables
 */

/**
 * Defines a Manageable which is an element with an history and a planning.
 *
 * @class Manageable
 * @constructor
 * @param {Object} manageable A device description object
 * @param {String} manageable.id The manageable id
 * @param {String} [manageable.name] The manageable name
 * @param {String} [manageable.state] The manageable state
 * @param {Array} [manageable.history] The list of history events related to the manageable
 * @param {Array} [manageable.schedules] The list of manageable&#x27;s schedules
 */
function Manageable(manageable) {
  Object.defineProperties(this, {

    /**
     * The manageable&#x27;s id.
     *
     * @property id
     * @type String
     * @final
     */
    id: {value: manageable.id, enumerable: true},

    /**
     * The manageable&#x27;s name.
     *
     * @property name
     * @type String
     * @final
     */
    name: {value: manageable.name, writable: true, enumerable: true},

    /**
     * The manageable&#x27;s history.
     *
     * @property history
     * @type Array
     */
    history: {value: manageable.history || [], writable: true, enumerable: true},

    /**
     * The manageable&#x27;s schedules.
     *
     * @property schedules
     * @type Array
     */
    schedules: {value: manageable.schedules || [], writable: true, enumerable: true}

  });
}

module.exports = Manageable;

/**
 * Checks if two schedules are in conflict.
 *
 * @example
 *
 *      Conflict examples :
 *
 *       schedule1 : [------------]
 *       schedule2 : [------------]
 *
 *       schedule1 : [------------]
 *       schedule2 :              [------------]
 *
 *       schedule1 :              [------------]
 *       schedule2 : [------------]
 *
 *       schedule1 : [------------]
 *       schedule2 :   [------------]
 *
 *       schedule1 :   [------------]
 *       schedule2 : [------------]
 *
 *       schedule1 : [------------]
 *       schedule2 :   [--------]
 *
 *       schedule1 :   [--------]
 *       schedule2 : [------------]
 *
 * @method checkSchedulesConflict
 * @param {Object} schedule1 Schedule object with :
 * @param {Date} schedule1.beginDate The begin date of the schedule
 * @param {Number} schedule1.duration The schedule duration (in ms)
 * @param {Boolean} [schedule1.recurrent=false] true if this is a daily schedule, false otherwise
 * @param {Date} [schedule1.endDate] The end date of the daily schedule (required if recurrent is set to true)
 * @param {Object} schedule2 Schedule object with :
 * @param {Date} schedule2.beginDate The begin date of the schedule
 * @param {Number} schedule2.duration The schedule duration
 * @param {Boolean} [schedule2.recurrent=false] true if this is a daily schedule, false otherwise
 * @param {Date} [schedule2.endDate] The end date of the daily schedule (required if recurrent is set to true)
 * @return {Boolean} true if there are in conflict, false otherwise
 */
Manageable.prototype.checkSchedulesConflict = function(schedule1, schedule2) {
  var schedule1DateTimeBegin = new Date(schedule1.beginDate);
  var schedule1DateDailyEnd = new Date(schedule1.endDate);
  var schedule1DateTimeEnd = new Date(schedule1DateTimeBegin.getTime() + schedule1.duration);
  var schedule2DateTimeBegin = new Date(schedule2.beginDate);
  var schedule2DateDailyEnd = new Date(schedule2.endDate);
  var schedule2DateTimeEnd = new Date(schedule2DateTimeBegin.getTime() + schedule2.duration);

  if ((schedule2DateTimeBegin &gt;= schedule1DateTimeBegin &amp;&amp; schedule2DateTimeBegin &lt;= schedule1DateTimeEnd) ||
    (schedule2DateTimeEnd &gt;= schedule1DateTimeBegin &amp;&amp; schedule2DateTimeEnd &lt;= schedule1DateTimeEnd) ||
    (schedule2DateTimeBegin &lt;= schedule1DateTimeBegin &amp;&amp; schedule2DateTimeEnd &gt;= schedule1DateTimeEnd)) {

    // Conflict between schedules&#x27; dates
    return true;
  }

  if (((schedule2DateTimeBegin &gt;= schedule1DateTimeBegin &amp;&amp; schedule2DateTimeBegin &lt;= schedule1DateDailyEnd) ||
    (schedule1DateTimeBegin &gt;= schedule2DateTimeBegin &amp;&amp; schedule1DateTimeBegin &lt;= schedule2DateDailyEnd) ||
    (schedule2DateDailyEnd &gt;= schedule1DateTimeBegin &amp;&amp; schedule2DateDailyEnd &lt;= schedule1DateDailyEnd) ||
    (schedule2DateTimeBegin &lt;= schedule1DateTimeBegin &amp;&amp; schedule2DateDailyEnd &gt;= schedule1DateDailyEnd)) &amp;&amp;
     (schedule1.recurrent || schedule2.recurrent)) {

    // Daily schedule with conflicting dates
    // Compare only time

    var schedule1TimeBegin = (schedule1DateTimeBegin.getHours() * 3600000) +
        (schedule1DateTimeBegin.getMinutes() * 60000) +
        schedule1DateTimeBegin.getSeconds() * 1000;
    var schedule1TimeEnd = (schedule1DateTimeEnd.getHours() * 3600000) +
        (schedule1DateTimeEnd.getMinutes() * 60000) +
        schedule1DateTimeEnd.getSeconds() * 1000;
    var schedule2TimeBegin = (schedule2DateTimeBegin.getHours() * 3600000) +
        (schedule2DateTimeBegin.getMinutes() * 60000) +
        schedule2DateTimeBegin.getSeconds();
    var schedule2TimeEnd = (schedule2DateTimeEnd.getHours() * 3600000) +
        (schedule2DateTimeEnd.getMinutes() * 60000) +
        schedule2DateTimeEnd.getSeconds() * 1000;

    if ((schedule2TimeBegin &gt;= schedule1TimeBegin &amp;&amp; schedule2TimeBegin &lt;= schedule1TimeEnd) ||
      (schedule2TimeEnd &gt;= schedule1TimeBegin &amp;&amp; schedule2TimeEnd &lt;= schedule1TimeEnd) ||
      (schedule2TimeBegin &lt;= schedule1TimeBegin &amp;&amp; schedule2TimeEnd &gt;= schedule1TimeEnd)) {

      // Conflict between schedules&#x27; times
      return true;
    }
  }

  return false;
};

/**
 * Adds an historic to manageable&#x27;s history.
 *
 * @method addHistoric
 * @param {Object} historic The historic
 * @param {String} historic.id The historic id
 */
Manageable.prototype.addHistoric = function(historic) {
  this.history.push(historic);
};

/**
 * Removes an historic from manageable&#x27;s history.
 *
 * @method removeHistoric
 * @param {String} historicId The historic id
 * @return {Object|Null} The removed historic or null if not found
 */
Manageable.prototype.removeHistoric = function(historicId) {
  var index = this.history.findIndex(function(historic) {
    return historic.id === historicId;
  });

  if (index &gt; -1)
    return this.history.splice(index, 1)[0];

  return null;
};

/**
 * Removes manageable&#x27;s history.
 *
 * @method removeHistory
 */
Manageable.prototype.removeHistory = function() {
  this.history = [];
};

/**
 * Adds a schedule to manageable&#x27;s schedules.
 *
 * @method addSchedule
 * @param {Object} schedule The schedule
 * @param {String} schedule.id The schedule id
 */
Manageable.prototype.addSchedule = function(schedule) {
  this.schedules.push(schedule);
};

/**
 * Removes a schedule from manageable&#x27;s schedules.
 *
 * @method removeSchedule
 * @param {String} scheduleId The schedule id
 * @return {Object|Null} The removed schedule or null if not found
 */
Manageable.prototype.removeSchedule = function(scheduleId) {
  var index = this.schedules.findIndex(function(schedule) {
    return schedule.id === scheduleId;
  });

  if (index &gt; -1)
    return this.schedules.splice(index, 1)[0];

  return null;
};

/**
 * Gets a schedule.
 *
 * @method getSchedule
 * @param {String} id The schedule id
 * @return {Object|Undefined} The schedule or null if not found
 */
Manageable.prototype.getSchedule = function(id) {
  return this.schedules.find(function(schedule) {
    return (schedule.id === id);
  });
};

/**
 * Checks if a schedule is not in collision with other schedules.
 *
 * @method isValidSchedule
 * @param {Object} schedule The schedule description object
 * @param {Date} schedule.beginDate The begin date of the schedule
 * @param {Number} schedule.duration The schedule duration (in ms)
 * @param {Boolean} [schedule.recurrent=false] true if this is a daily schedule, false otherwise
 * @param {Date} [schedule.endDate] The end date of the daily schedule (required if recurrent is set to true)
 * @return {Boolean} true if the schedule is not in collision with other schedules
 * false otherwise
 */
Manageable.prototype.isValidSchedule = function(schedule) {
  var i = 0;

  // Start date is after end date or start date is before now
  if ((schedule.endDate &amp;&amp; schedule.beginDate &gt;= schedule.endDate) || schedule.beginDate &lt;= new Date())
    return false;


  // Validates that the schedule is not in conflict with one of the existing schedules
  for (i = 0; i &lt; this.schedules.length; i++) {
    if (this.checkSchedulesConflict(this.schedules[i], schedule))
      return false;
  }

  return true;
};

/**
 * Checks if a schedule is actually running.
 *
 * @method isScheduleRunning
 * @param {Object} schedule The schedule description object
 * @param {Date} schedule.beginDate The begin date of the schedule
 * @param {Number} schedule.duration The schedule duration (in ms)
 * @param {Boolean} [schedule.recurrent=false] true if this is a daily schedule, false otherwise
 * @param {Date} [schedule.endDate] The end date of the daily schedule (required if recurrent is set to true)
 * @return {Boolean} true if the schedule is running, false otherwise
 */
Manageable.prototype.isScheduleRunning = function(schedule) {
  var beginDate = new Date(schedule.beginDate);
  var endDate = new Date(schedule.beginDate.getTime() + schedule.duration);
  var beginTime = beginDate.getHours() * 3600000 + beginDate.getMinutes() * 60000 + beginDate.getSeconds() * 1000;
  var endTime = endDate.getHours() * 3600000 + endDate.getMinutes() * 60000 + endDate.getSeconds() * 1000;
  var now = new Date();
  var nowTime = now.getHours() * 3600000 + now.getMinutes() * 60000 + now.getSeconds() * 1000;

  return (
    (
      beginDate &lt;= now &amp;&amp;
      endDate &gt;= now &amp;&amp;
      !schedule.recurrent
    ) ||
    (
      schedule.recurrent &amp;&amp;
      schedule.endDate &amp;&amp;
      schedule.endDate &gt;= now &amp;&amp;
      beginTime &lt;= nowTime &amp;&amp;
      endTime &gt;= nowTime &amp;&amp;
      beginDate &lt;= now
    )
  );
};

/**
 * Checks if a schedule has expired.
 *
 * Schedule is considered expired if one of the following condition is filled :
 *   - Schedule is not recurrent and schedule has finished
 *   - Schedule is recurrent and this is the end date and day schedule has finished
 *
 * @method isScheduleExpired
 * @param {Object} schedule The schedule description object
 * @param {Date} schedule.beginDate The begin date of the schedule
 * @param {Number} schedule.duration The schedule duration (in ms)
 * @param {Boolean} [schedule.recurrent=false] true if this is a daily schedule, false otherwise
 * @param {Date} [schedule.endDate] The end date of the daily schedule (required if recurrent is set to true)
 * @return {Boolean} true if the schedule has expired, false otherwise
 */
Manageable.prototype.isScheduleExpired = function(schedule) {
  var beginDate = new Date(schedule.beginDate);
  var endDate = new Date(schedule.beginDate.getTime() + schedule.duration);
  var now = new Date();

  return (
    (
      beginDate &lt; now &amp;&amp;
      endDate &lt; now &amp;&amp;
      !schedule.recurrent
    ) ||
    (
      schedule.recurrent &amp;&amp;
      schedule.endDate &amp;&amp;
      schedule.endDate &lt; now
    )
  );
};

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
